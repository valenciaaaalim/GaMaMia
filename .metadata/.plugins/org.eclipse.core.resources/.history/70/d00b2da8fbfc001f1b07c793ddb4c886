/**
* Name: rat4
* Based on the internal empty template. 
* Author: valencia
* Tags: 
*/


model rat4

/* Insert your model definition here */


global {
    int num_rats <- 50;
    float infection_prob <- 0.1;
    
    init {
        create Rat number: num_rats;
    }
}

species Rat {
    point position;
    bool infected <- rnd(1) < infection_prob;
    
    aspect base {
        draw sphere(1) color: (infected ? #red : #gray);
    }

    reflex move_randomly {
        vector move_dir <- {rnd(-1,1), rnd(-1,1), 0}; // Move randomly in x-y plane
        if (rnd(1) < 0.1) { // Occasionally move up/down
            move_dir.z <- (rnd(1) < 0.5 ? 5 : -5); // Move between floors
        }
        position <- position + move_dir;
    }

    reflex spread_infection {
        ask (Rat) {
            if (!each.infected and distance_to(each) < 5) {
                if (rnd(1) < 0.5) { // 50% chance of infection on contact
                    each.infected <- true;
                }
            }
        }
    }
    
    init {
        position <- {rnd(100), rnd(100), (rnd(1) < 0.5 ? 0 : 10)}; // Random position, either floor 0 or 10
    }
}

experiment simulate type: gui {
    output {
        display "3D Building" background: #black {
            species Rat aspect: base;
        }
    }
}
